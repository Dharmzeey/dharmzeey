---
import Layout from "../../layouts/Layout.astro";
import { getAllPosts, getSinglePost } from "../../lib/contentful.js";

// Generate static paths
export async function getStaticPaths() {
  const posts = await getAllPosts();
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const content = post.content;

// Format SEO fields safely
const title = `${post.title} | Dharmzeey Blog`;
const description = `Read "${post.title}" by ${post.author}. ${post.content?.toString().slice(0, 140)}...`;
const ogImage = post.image || "https://dharmzeey.com/idea.jpg";
const canonicalURL = `https://dharmzeey.com/blogs/${post.slug}`;
---

<Layout
  title={title}
  description={description}
  keywords="Dharmzeey blog, web development articles, tech insights, programming tutorials, design tips, coding best practices, software development blog, tech trends, developer resources"
  ogImage={ogImage}
  canonicalURL={canonicalURL}
  structuredData={{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    headline: post.title,
    image: ogImage,
    author: {
      "@type": "Person",
      name: post.author || "Dharmzeey",
      url: "https://dharmzeey.com",
    },
    publisher: {
      "@type": "Organization",
      name: "Dharmzeey",
      logo: {
        "@type": "ImageObject",
        url: "https://dharmzeey.com/idea.jpg",
      },
    },
    url: canonicalURL,
    datePublished: post.date,
    description: description,
  }}
>
  <body class="text-white mb-20 relative overflow-hidden">
    <main class="min-h-screen max-w-3xl mx-auto px-6 py-16">
      <article>
        <h1 class="text-4xl font-bold mb-4">{post.title}</h1>
        <p class="text-gray-400 text-sm mb-8">
          <!-- By {post.author} • {new Date(post.date).toLocaleDateString()} -->
        </p>

        {
          post.image && (
            <img
              src={post.image}
              alt={post.title?.toString()}
              class="rounded-xl w-full mb-10 shadow-lg"
            />
          )
        }

        <div
          class="prose prose-invert prose-lg max-w-none"
          set:html={content}
        />

        <div class="mt-10">
          <a href="/blogs" class="text-blue-400 hover:text-blue-300 text-sm"
            >← Back to Blogs</a
          >
        </div>
      </article>
    </main>
  </body>
</Layout>
